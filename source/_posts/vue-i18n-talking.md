---
title: Vue-i18n 5.x在管理端项目中的应用
date: 2017-12-20 00:19:46
tags: 
- 前端
categories:
- Front-end
---


# 0x02 Vue-i18n 5.x在管理端项目中的应用

目前状态是身先士卒的卒，目标是给出合理的方案。

进入[kazuya](https://github.com/kazupon)的github，有几点引起了我的注意。

Section 1:

![commit kazuya](/vue-i18n-talking/commit-kazuya.png)

![commit razor](/vue-i18n-talking/commit-razor.png)

心情像是去上初中第一节课，老师和大家说，如果要读一所不错的大学，你需要付出的努力



Section 2:

![commit-view](/vue-i18n-talking/commit-view.png)

有趣的git提交标记

📝(docs) 🔧(config) 🆙(update) 📦(build) 🍭(examples)

🐛(bug) 🔥(fire) ⚡(impovement) ✨(release) 📌(dependency) 

✅(test) ⭐(new)

## Vue-i18n 5.x与6.x的区别

vue-i18n 6.x作为5.x的大版本迭代，当然比5.x优秀。主要体现在以下几个方面：
+ 文档质量（5.x的文档隐藏的信息得从issue去读取切换语言的方法等）
+ 自定义指令（个人觉得在6.x中一个实用的新功能，主要能力是降低了切换语言的性能成本）
+ 默认支持了日期、货币的一些方法



## 多语言应用场景

### vue业务组件

如果想要在js中引用，那就必须引入Vue-i18n实例。实际应用中甚至你会发现有些词它是不会更新的，因为开发者常常会把值赋给对应的变量，而再引入js文件传入vue对象。这时候引用关系就丢失了（数组和对象除外）。

> !组件开发中最好尽量别引入vue-i18n

组件作为一个独立的单元，实现可拔插是一个基本原则，不应当去依赖项目中的vue-i18n。



## 复数等特殊应用

5.x提供$tc方法去判断单复数。6.x提供了货币以及日期的国际化



## 暂定的方案

1. 先说说被否决的方案：放置在组件内。这种方式方便开发者去快速修改和定位，如果需要提取给翻译者恐怕不太合适。
2. 采用的方案：以页面为单位分成多个json文件（这种方法仍待验证）



对于第二种方案，阐述下基本思路：

优先级 store > localstorage > 浏览器 > 默认值

这里可以分为三种情况：

1. 初次进入页面且没有localstorage，我们取到浏览器的值，再请求配置项，如果配置项语言与初设值不同，那么需要修改当前语言设置
2. 初次进入页面但是存在localstorage，我们取到上一次用户的习惯值（localstorage值）
3. 单页面应用页面间跳转，我们取到store的值



响应用户动态切换语言操作：

1. 设置请求头里的语言配置参数Access-Language
2. 存储新的语言值至localstorage
3. 设置html 语言
4. 切换i18n的语言
5. 当前页面重新请求数据



## 注意事项

1. 如果通过props传入i18n的语言值，需要注意子组件内二次赋值导致引用丢失
2. 通过浏览器拿到的语言不一定在支持列表里，所以需要配置fallback值



## 存在的疑惑
关于重新请求页面的数据的处理方式。提出两个方案：

   1. 给最外层的router-view设置一个时间戳key，每当语言切换后重新渲染所有的组件。这样的做法是不够优雅的，但是不必在每个组件内去单独监听语言值的变化。
   2. 每个组件内单独监听语言的变化，重新发起对应的数据请求

   我更倾向于第二种。下一次重新审视这个问题，我相信能给出具体的原因去阐述自己的选择。



## End

文章持续更新，大家可以在下方留言



